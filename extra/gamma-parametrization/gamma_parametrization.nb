(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[      7857,        218]
NotebookOptionsPosition[      6328,        186]
NotebookOutlinePosition[      6691,        202]
CellTagsIndexPosition[      6648,        199]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Parametrization of additive and non-additive effects", "Title",
 CellChangeTimes->{{3.800360920558805*^9, 
  3.800360933323667*^9}},ExpressionUUID->"285e1ae0-191b-4d13-9dd1-\
fd8b8ce5b85b"],

Cell["\<\
Use this script to find the right parametrization for additive and epsitatic \
effects such that both are expected to produce equivalent phenotypic \
distributions if the genotypes are totally random.\
\>", "Text",
 CellChangeTimes->{{3.800360821678524*^9, 
  3.800360910343799*^9}},ExpressionUUID->"d7a4638e-989c-4061-9a78-\
34cf05a39857"],

Cell["We want to solve the following equation:", "Text",
 CellChangeTimes->{{3.80036128491432*^9, 
  3.800361289175811*^9}},ExpressionUUID->"a646d2d9-d38f-4bef-a282-\
875d537ce96d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"eq", " ", "=", " ", 
   RowBox[{
    FractionBox[
     RowBox[{
      SuperscriptBox[
       SubscriptBox["\[Theta]", "\[Omega]"], "2"], 
      RowBox[{"Gamma", "[", 
       RowBox[{
        SubscriptBox["k", "\[Omega]"], "+", "2"}], "]"}], 
      RowBox[{"Gamma", "[", 
       SubscriptBox["k", "\[Eta]"], "]"}]}], 
     RowBox[{
      SuperscriptBox[
       SubscriptBox["\[Theta]", "\[Eta]"], "2"], 
      RowBox[{"Gamma", "[", 
       RowBox[{
        SubscriptBox["k", "\[Eta]"], "+", "2"}], "]"}], 
      RowBox[{"Gamma", "[", 
       SubscriptBox["k", "\[Omega]"], "]"}]}]], "\[Equal]", 
    FractionBox[
     RowBox[{"2", " ", "n"}], 
     RowBox[{"3", " ", "e"}]]}]}], ";"}]], "Input",
 CellChangeTimes->{{3.800361009103402*^9, 3.800361192949003*^9}},
 CellLabel->"In[1]:=",ExpressionUUID->"c7a7d62d-6616-49fc-809a-32b74c746a39"],

Cell["\<\
Enter parameter values here, except for the one that must be solved:\
\>", "Text",
 CellChangeTimes->{{3.8003612941323566`*^9, 
  3.800361303402467*^9}},ExpressionUUID->"4520bfda-976a-4d6d-b27c-\
ef9afac4ab40"],

Cell[BoxData[
 RowBox[{
  RowBox[{"pars", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      SubscriptBox["\[Theta]", "\[Eta]"], "\[Rule]", "1"}], ",", 
     RowBox[{
      SubscriptBox["\[Theta]", "\[Omega]"], "\[Rule]", "1"}], ",", 
     RowBox[{
      SubscriptBox["k", "\[Eta]"], "\[Rule]", "1"}], ",", 
     RowBox[{"n", "\[Rule]", "100"}], ",", 
     RowBox[{"e", "\[Rule]", "1000"}]}], "}"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.800361206803664*^9, 3.800361270063141*^9}, {
  3.8003613565367527`*^9, 3.800361369779386*^9}, {3.8003614198828382`*^9, 
  3.8003614543829937`*^9}, {3.800361764650453*^9, 3.800361764737224*^9}, {
  3.806905982358769*^9, 3.8069060118415813`*^9}},
 CellLabel->"In[7]:=",ExpressionUUID->"9f555f6c-3ecf-4ee8-b0c3-e1cdb0b699c0"],

Cell["\<\
We use the following equation solver to find the missing parameter value:\
\>", "Text",
 CellChangeTimes->{{3.800361546032214*^9, 
  3.800361557725449*^9}},ExpressionUUID->"52619917-af43-4b42-9138-\
d9bcba1d4d2a"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Solve", "[", 
  RowBox[{
   RowBox[{"eq", "/.", "pars"}], ",", " ", 
   SubscriptBox["k", "\[Omega]"]}], "]"}]], "Input",
 CellChangeTimes->{{3.800361311069162*^9, 3.800361338761568*^9}, {
  3.8003615084602613`*^9, 3.8003615094976177`*^9}, {3.800361610317677*^9, 
  3.800361694354175*^9}},
 CellLabel->"In[8]:=",ExpressionUUID->"2db58562-607c-49e9-b19c-0ec2ac8e5a95"],

Cell[BoxData[
 TemplateBox[{
  "Solve","fexp",
   "\"Warning: \\!\\(\\*RowBox[{\\\"Solve\\\"}]\\) used FunctionExpand to \
transform the system. Since FunctionExpand transformation rules are only \
generically correct, the solution set might have been altered.\"",2,8,3,
   29898724637307162009,"Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{
  3.800361538510468*^9, {3.800361603728374*^9, 3.800361694890486*^9}, 
   3.8003617686731443`*^9, {3.8069059868017273`*^9, 3.806906014821519*^9}},
 CellLabel->
  "During evaluation of \
In[8]:=",ExpressionUUID->"a8f52250-e4df-4306-a0d9-e492acd262ce"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     SubscriptBox["k", "\[Omega]"], "\[Rule]", 
     RowBox[{
      FractionBox["1", "30"], " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"-", "15"}], "-", 
        SqrtBox["345"]}], ")"}]}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     SubscriptBox["k", "\[Omega]"], "\[Rule]", 
     RowBox[{
      FractionBox["1", "30"], " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"-", "15"}], "+", 
        SqrtBox["345"]}], ")"}]}]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.800361603734796*^9, 3.800361694896615*^9}, 
   3.80036176867752*^9, {3.806905986806176*^9, 3.80690601482627*^9}},
 CellLabel->"Out[8]=",ExpressionUUID->"b5be421f-a597-451d-b009-df638c43ae8c"]
}, Open  ]],

Cell["\<\
If the solver did not work, for some reason, we use a numerical root-finding \
algorithm. Less accurate, but more robust.\
\>", "Text",
 CellChangeTimes->{{3.800361573870104*^9, 
  3.800361597569469*^9}},ExpressionUUID->"f43966fd-438f-42b4-b7ae-\
c3e84ce553d4"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"FindRoot", "[", 
  RowBox[{
   RowBox[{"eq", "/.", "pars"}], ",", " ", 
   RowBox[{"{", 
    RowBox[{
     SubscriptBox["k", "\[Omega]"], ",", "0"}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.8003615106228933`*^9, 3.800361525121558*^9}},
 CellLabel->"In[9]:=",ExpressionUUID->"f2900146-ef8c-4243-a23a-0d1c8b85033c"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   SubscriptBox["k", "\[Omega]"], "\[Rule]", "0.11913918736689065`"}], 
  "}"}]], "Output",
 CellChangeTimes->{{3.800361339532708*^9, 3.8003613714894733`*^9}, {
   3.8003614228184433`*^9, 3.800361456938073*^9}, 3.800361525885556*^9, 
   3.80036169679423*^9, 3.800361771554598*^9, 3.806906033773108*^9},
 CellLabel->"Out[9]=",ExpressionUUID->"0440b7d4-5e46-49fd-a2bd-f53893ed0f76"]
}, Open  ]]
}, Open  ]]
},
WindowSize->{2426, 1329},
WindowMargins->{{0, Automatic}, {0, Automatic}},
Magnification:>2. Inherited,
FrontEndVersion->"12.0 for Linux x86 (64-bit) (April 8, 2019)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 195, 3, 198, "Title",ExpressionUUID->"285e1ae0-191b-4d13-9dd1-fd8b8ce5b85b"],
Cell[778, 27, 350, 7, 122, "Text",ExpressionUUID->"d7a4638e-989c-4061-9a78-34cf05a39857"],
Cell[1131, 36, 181, 3, 73, "Text",ExpressionUUID->"a646d2d9-d38f-4bef-a282-875d537ce96d"],
Cell[1315, 41, 873, 25, 121, "Input",ExpressionUUID->"c7a7d62d-6616-49fc-809a-32b74c746a39"],
Cell[2191, 68, 220, 5, 73, "Text",ExpressionUUID->"4520bfda-976a-4d6d-b27c-ef9afac4ab40"],
Cell[2414, 75, 778, 17, 66, "Input",ExpressionUUID->"9f555f6c-3ecf-4ee8-b0c3-e1cdb0b699c0"],
Cell[3195, 94, 223, 5, 73, "Text",ExpressionUUID->"52619917-af43-4b42-9138-d9bcba1d4d2a"],
Cell[CellGroupData[{
Cell[3443, 103, 391, 8, 63, "Input",ExpressionUUID->"2db58562-607c-49e9-b19c-0ec2ac8e5a95"],
Cell[3837, 113, 616, 13, 85, "Message",ExpressionUUID->"a8f52250-e4df-4306-a0d9-e492acd262ce"],
Cell[4456, 128, 765, 23, 125, "Output",ExpressionUUID->"b5be421f-a597-451d-b009-df638c43ae8c"]
}, Open  ]],
Cell[5236, 154, 271, 6, 73, "Text",ExpressionUUID->"f43966fd-438f-42b4-b7ae-c3e84ce553d4"],
Cell[CellGroupData[{
Cell[5532, 164, 345, 8, 63, "Input",ExpressionUUID->"f2900146-ef8c-4243-a23a-0d1c8b85033c"],
Cell[5880, 174, 420, 8, 133, "Output",ExpressionUUID->"0440b7d4-5e46-49fd-a2bd-f53893ed0f76"]
}, Open  ]]
}, Open  ]]
}
]
*)

