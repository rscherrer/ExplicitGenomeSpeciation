---
title: "egssimtools: an R package for the analysis of a model of speciation"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{vignette}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

This package comes with the [ExplicitGenomeSpeciation](https://github.com/rscherrer/ExplicitGenomeSpeciation) program, an individual-based simulation of a speciation event with explicitly modelled diploid genomes and a flexible genotype-phenotype map. This package includes tools to facilitate the extraction and processing of the data generated by the simulation model. Throughout we will use example simulations from the `data` folder. 

## Installation

To install the package, click on the RStudio project `egssimtools.Rproj` to open it in RStudio, then in the "Build" tab, click "Install and Restart". The package should be installed on your machine.

Let us now load the package.

```{r, message = FALSE}
library(egssimtools)
library(tidyverse)
```

Each simulation is stored in a simulation folder. The content of a simulation folder depends on the settings used when running the program (see detailed [description](https://github.com/rscherrer/ExplicitGenomeSpeciation)). This package introduces functions to retrieve data, but also parameters and genetic architectures saved during the simulations.

## Read data

The most important function is `read_data`. This function allows the user to read the data from one simulation. The user provides the names of the variables to be read, optional parameters to be read too, and the output is returned in a data frame, suitable for further analyses or merging with other data frames. We can for example read speciation metrics through time for one simulation, and add a specific set of parameters to them:

```{r}
root <- "../data/example_1"
data <- read_data(root, variables = c("time", "EI", "RI", "SI"), parnames = c("ecosel", "hsymmetry"))
head(data, 4)
```

For these variables, there is one value per time point throughout the simulation, while the values of the two parameters are unique to the simulation. Parameter values are therefore duplicated as many times as there are rows in the resulting table.

Here, all variables have the same length (one value per time point). Simulation output sometimes has different dimensions (see the main page for details). Genome-wide Fst, for example, is computed for each of the three traits separately at each time point, and saved into the same linear binary file. The file `Fst.dat` is therefore three times as long as `time.dat`, and we need to split the former in three columns to be able to append it to the latter. We use the `by` argument for that:



